<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/lodash.js/0.9.0/lodash.js"></script>
    <style>
      html, body {
        padding: 0;
        margin: 0;
      }

      /* ваши стили */
      .draggable-window {
        position: absolute;
        z-index: 999;

        background-color: lightblue;
        border: 1px solid blue;
      }

      .draggable-window.dragging .draggable-window-title {
        cursor: move;
      }

      .draggable-window-title {
        cursor: pointer;
        color: white;
        background-color: blue;
        text-align: center;
      }

      .draggable-window-dialog {
        height: 200px;
        overflow: auto;

        background-color: white;
        border: 1px solid blue;
      }

    </style>
</head>
<body>

Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст
Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст
Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст
Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст
Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст
Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст Текст

<script type="text/template" id="draggable-window-template">
  <div class="draggable-window" style="top: 0; left: 0;">
    <div class="draggable-window-title"><%=title%></div>
    <div class="draggable-window-dialog"></div>
    <form class="draggable-window-message-form">
      <input type+"text" class="draggable-window-message"></input>
      <input type="submit" class="draggable-window-submit"></input>
    </form>
  </div>
</script>

<script>

// если начать перенос и передвинуть мышь максимально вверх -- верхний край окна не должен вылетать за край страницы.
// в другие стороны

// чтобы даже при резких движениях мыши -- окно прилипало к краю но не вылезало за край
// исключение -- максимальная нижняя позиция окна -- это когда только заголовок виден

// позиция мыши смещается
function DraggableWindow(options) {
  var self = this;

  var elem;
  var template = _.template(options.template);

  /* ваш код */
  function render() {
    elem = $(template({
      title: options.title,
    }));

    elem.on("mousedown", ".draggable-window-title", onTitleDown);
    elem.find(".draggable-window-message-form").on("submit", onMessageSubmit);

    return elem;
  }

  function onMessageSubmit() {
    sendMessage();

    return false;
  }

  function sendMessage() {
    elem.find(".draggable-window-dialog").append($("<p/>", {
      html: elem.find(".draggable-window-message").html(),
    }));
  }

  function startDrag(x, y) {
    elem.addClass("dragging");

    var shiftX = x - elem.offset().left;
    var shiftY = y - elem.offset().top;

    $(document).on("mousemove.dragging", onMove)
    .on("mouseup.dragging", onUp);

    function onMove(e) {
      moveAt(e.pageX, e.pageY);
    }

    function onUp() {
      stopDrag();
    }

    function stopDrag() {
      elem.removeClass("dragging");
      $(document).off(".dragging");
    }

    function moveAt(x, y) {
      elem.css({
        left: x - shiftX + "px",
        top: y - shiftY + "px",
      });
    }

  }


  function onTitleDown(e) {
    startDrag(e.pageX, e.pageY);
  }


  self.getElement = function() {
    return elem || render();
  }
}

var win = new DraggableWindow({
  title: "Чат с Петей",
  template: $('#draggable-window-template').html()
});

win.getElement().appendTo('body');

</script>

</body>
</html>
